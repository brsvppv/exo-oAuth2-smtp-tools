# Test-MailNotification

## Synopsis
Sends a real test email using the OAuth 2.0 Client Credentials flow.

## Description
This script simulates exactly what Business Central does. It authenticates as the Application (using Client ID and Secret) and attempts to send an email via `smtp.office365.com` on port 587. It is the ultimate "proof of pudding" test.

## Usage

### Send a Test Email
```powershell
.\Test-MailNotification.ps1 `
    -ClientId "your-client-id" `
    -TenantId "your-tenant-id" `
    -ClientSecret "your-client-secret" `
    -Sender "no-reply@contoso.com" `
    -Recipient "admin@contoso.com"
```

### Remote Execution (One-Liner)
```powershell
irm https://raw.githubusercontent.com/brsvppv/exo-oAuth2-smtp-tools/refs/heads/main/Scripts/Test-MailNotification.ps1 | iex; Invoke-ApiMailNotification -ClientID "x" -SecretValue "y" -TenantID "z" -Subject "Hi" -MailSender "a@b.com" -Recipent "c@d.com" -Massage "Hello"
```

## Parameters

| Parameter | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| **ClientId** | String | Yes | The Application ID created by the provisioning script. |
| **TenantId** | String | Yes | The Directory (Tenant) ID. |
| **ClientSecret** | String | Yes | The secret generated by the provisioning script. |
| **Sender** | String | Yes | The email address sending the mail (must be one of the authorized mailboxes). |
| **Recipient** | String | Yes | The email address to receive the test mail. |

## Troubleshooting
If this script fails:
1.  **"Authentication Unsuccessful":** Usually means `SMTP Client Authentication` is disabled on the mailbox or organization. Run `New-ExoOauthSmtpAppIdentity` again with `-FixMailboxSmtp`.
2.  **"SendAsDenied":** The app lacks the `SendAs` permission. Run `New-ExoOauthSmtpAppIdentity` again with `-AddSendAs`.
